"use strict";(self["webpackChunkDINGGUL"]=self["webpackChunkDINGGUL"]||[]).push([[189],{5170:function(e,t,a){a.d(t,{Z:function(){return v}});var l=a(6252),s=a(2262),o=a(3577),n=a(4254);const i=["😀","😃","😄","😁","😆","😅","😂","🤣","😈","🤔","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","👿","🤩","🥳","😏","😒","😞","😔","😟","😕","🙁","👻","😣","😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬","🤯","😳"],r={class:"emoji-container"},u={class:"emojis"},d=["onClick"],c=(0,l._)("button",{class:"md-editor-icon"}," 🙂 ",-1);var p={__name:"EmojiExtension",props:{onInsert:{type:Function,default:()=>()=>null}},setup(e){const t=e,{DropdownToolbar:a}=n.Z,p=(0,s.qj)({visible:!1}),m=e=>{const a=()=>({targetValue:e,select:!1,deviationStart:0,deviationEnd:0});t.onInsert(a)},v=e=>{p.visible=e};return(e,t)=>((0,l.wg)(),(0,l.j4)((0,s.SU)(a),{title:"emoji",visible:p.visible,onOnChange:v},{overlay:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l._)("ol",u,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,s.SU)(i),((e,t)=>((0,l.wg)(),(0,l.iD)("li",{key:`emoji-${t}`,onClick:t=>m(e)},(0,o.zw)(e),9,d)))),128))])])])),trigger:(0,l.w5)((()=>[c])),_:1},8,["visible"]))}};const m=p;var v=m},2747:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});a(7658);var l=a(6252),s=a(2262),o=a(3577),n=a(9963),i=a(2201),r=a(3907),u=a(2127),d=a(4254),c=a(5170),p=a(6351),m=a(4835);const v=e=>((0,l.dD)("data-v-92df21be"),e=e(),(0,l.Cn)(),e),g={class:"editor"},b={class:"wrap_select_toggle"},_={class:"select"},f={class:"main"},w=v((()=>(0,l._)("option",{disabled:"",hidden:"",value:""},"메뉴 선택",-1))),y=["value"],h={class:"sub"},S=["disabled"],k=v((()=>(0,l._)("option",{disabled:"",hidden:"",value:""},"게시판 선택",-1))),T=["value"],E={class:"category"},U=["disabled"],I=v((()=>(0,l._)("option",{disabled:"",hidden:"",value:""},"카테고리 선택",-1))),q=["value"],C={class:"wrap_toggle"},D={class:"wrap_title"},P={class:"title"},L={class:"content"},F={class:"wrap_gpt_btns"},O={class:"wrap_image_btns"},N={class:"images_add_btn"},A={for:"upload_input",class:"upload_label"},H={key:0,class:"images"},j={class:"wrap_thumbnail"},x=["src","alt","onClick","onErrorOnce"],G={class:"wrap_btns"};var M={__name:"Editor",setup(e){d.Z.config({editorConfig:{languageUserDefined:{"ko-KR":m.s}}});const t=(0,i.yj)(),{push:a}=(0,i.tv)(),{state:v,dispatch:M,commit:R}=(0,r.oR)(),Y=(0,l.f3)("isMobile"),K=(0,l.f3)("DIALOG_EL"),V=(0,l.f3)("TOAST_EL"),Z=(0,s.iH)(null);let $=null,W=null,B=null,z=!0;const J=(0,l.Fl)({get:()=>v.post.post.menu?.main??"",set:e=>R("post/SET_MAIN",e)}),Q=(0,l.Fl)({get:()=>v.post.post.menu?.sub??"",set:e=>R("post/SET_SUB",e)}),X=(0,l.Fl)({get:()=>v.post.post.category??"",set:e=>R("post/SET_CATEGORY",e)}),ee=(0,l.Fl)({get:()=>v.post.post.title??"",set:e=>R("post/SET_TITLE",e)}),te=(0,l.Fl)({get:()=>v.post.post.content??"",set:e=>R("post/SET_CONTENT",e)}),ae=(0,l.Fl)({get:()=>v.post.post.isPublic,set:e=>R("post/SET_IS_PUBLIC",e)}),le=(0,l.Fl)({get:()=>v.post.post.images??[],set:e=>R("post/SET_IMAGES",e)}),se=(0,l.Fl)({get:()=>v.post.post.thumbnail??"",set:e=>R("post/SET_THUMBNAIL",e)}),oe=(0,s.qj)({main:J,sub:Q,title:ee,content:te,category:X,isPublic:ae,images:(0,l.Fl)((()=>le.value.length>0?le.value.map((e=>e._id)):[])),thumbnail:se}),ne=()=>{document.body.querySelector("div.sub select").selectedIndex=0,document.body.querySelector("div.category select").selectedIndex=0},ie=()=>{document.body.querySelector("div.category select").selectedIndex=0},re=e=>{ae.value=Boolean(e)},ue=async({payload:e})=>{if(!$){const{success:e,draft:t,error:a}=await M("draft/createDraft",{payload:oe});if(!e)return{success:e,images:[],error:a};$=t._id}const{success:t,images:a,error:l}=await M("draft/updateDraft",{draftId:$,payload:e||oe});return t&&V.value.open("success","임시저장 되었습니다."),{success:t,images:a,error:l}},de=async()=>{const{success:e,post:l,error:s}=t.query.postId?await M("post/updatePost",{payload:oe}):await M("post/createPost",{payload:oe});if(!e)return V.value.open("error",s);a({name:"post",params:{postId:l._id}})},ce=async e=>{if(!e.target.files.length)return;for(const{name:t}of e.target.files)if(String(t).split(".")[0].length>32)return V.value.open("error","파일명은 32자 이하만 가능합니다.");const a=new FormData;Object.values(e.target.files).forEach((e=>a.append("images",e))),Object.entries(oe).forEach((([e,t])=>a.append(e,t)));const{success:s,images:o,error:n}=t.query.postId?await M("post/updatePost",{payload:a}):await ue({payload:a});if(!s)return V.value.open("error",n);if(Array.isArray(o)&&o.length){le.value=o,ve(o[0]);for await(const e of o)(0,l.Y3)(),ge(e.thumbnail)}},pe=(e,t)=>{e.target.src="https://dev-img.dinggul.me/"+t},me=async(e,a)=>{const{success:l,error:s}=t.query.postId?await M("post/deleteFile",{imageId:e,index:a}):await M("draft/deleteFile",{imageId:e,index:a,draftId:$});if(!l)return V.value.open("error",s)},ve=e=>{se.value=e?.thumbnail},ge=e=>{const t=document.querySelector("#md-editor-v3-textarea");let a=t.value.substring(0,t.selectionStart),l=t.value.substring(t.selectionEnd,t.value.length);const s=`\n![](${e})\n`;te.value=a+s+l,t.focus()},be=async()=>{const e=`//localhost:3000/v1/openai/stream/completions?prompt=${ee.value}`;return!B||0!==B.readyState&&1!==B.readyState?ee.value.length<6?V.value.open("error","제목을 최소 5글자 이상 입력해주세요."):(B=new EventSource(e,{withCredentials:!0}),B.onmessage=e=>{const t=JSON.parse(e.data);te.value+=t},void(B.onerror=e=>{"DONE"===e.data?V.value.open("success","초안 작성을 완료하였습니다."):V.value.open("error","서버와 통신이 원할하지 않습니다. 잠시 후 다시 시도해 주세요."),B.close()})):V.value.open("error","초안 생성 중입니다. 생성 종료 버튼을 눌러 진행을 멈추거나 생성이 종료된 후 다시 시도해 주세요.")},_e=()=>{B.close()},fe=e=>{z=e},we=e=>{Z.value?.insert(e)},ye=e=>{z||(e.preventDefault(),e.returnValue="")};return(0,l.YP)((()=>z),((e,a)=>{!e||a||W||(W=t.query.postId?setInterval(de,3e5):setInterval(ue,3e5))})),(0,l.YP)(Q,(()=>{J.value&&R("menu/SET_CURRENT_MENUS",{main:J.value,sub:Q.value})}),{immediate:!0}),(0,l.YP)((()=>t.query),(async()=>{if(t.query.postId&&t.query.postId!==v.post.post._id){const{success:e,error:l}=await M("post/getPost",{postId:t.query.postId});if(!e)return V.value.open("error",l),a({name:"editor"})}else if(t.query.draftId){const{success:e,error:l}=await M("post/getDraft",{draftId:t.query.draftId});if(!e)return V.value.open("error",l),a({name:"editor"});$=t.query.draftId}else t.fullPath.includes("?")||R("post/UNSET_POST")}),{immediate:!0}),(0,l.bv)((()=>{window.addEventListener("beforeunload",ye),ve(le.value[0])})),(0,l.Ah)((()=>{window.removeEventListener("beforeunload",ye),clearInterval(W)})),(0,i.iS)((async(e,t,a)=>{if(z)a();else{const e=await K.value.show({title:"현재 페이지에서 나가시겠습니까?",message:"임시 저장되지 않은 내용은 사라질 수 있습니다.",okButton:"나가기",cancelButton:"잠시만요!"});e?a():a(!1)}})),(e,t)=>{const a=(0,l.up)("Button"),i=(0,l.up)("Ico");return(0,l.wg)(),(0,l.iD)("div",g,[(0,l._)("div",b,[(0,l._)("div",_,[(0,l._)("div",f,[(0,l.wy)((0,l._)("select",{required:"","onUpdate:modelValue":t[0]||(t[0]=e=>(0,s.dq)(J)?J.value=e:null),onChange:ne},[w,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Object.keys(e.$store.state.menu.menus),(e=>((0,l.wg)(),(0,l.iD)("option",{key:e,value:e},(0,o.zw)(e),9,y)))),128))],544),[[n.bM,(0,s.SU)(J)]])]),(0,l._)("div",h,[(0,l.wy)((0,l._)("select",{required:"","onUpdate:modelValue":t[1]||(t[1]=e=>(0,s.dq)(Q)?Q.value=e:null),disabled:!(0,s.SU)(J),onChange:ie},[k,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.$store.state.menu.menus[(0,s.SU)(J)],(e=>((0,l.wg)(),(0,l.iD)("option",{key:e.sub,value:e.sub},(0,o.zw)(e.sub),9,T)))),128))],40,S),[[n.bM,(0,s.SU)(Q)]])]),(0,l._)("div",E,[(0,l.wy)((0,l._)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>(0,s.dq)(X)?X.value=e:null),disabled:!(0,s.SU)(Q)},[I,(0,s.SU)(Q)?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(e.$store.state.menu.categories,(e=>((0,l.wg)(),(0,l.iD)("option",{key:e,value:e},(0,o.zw)(e),9,q)))),128)):(0,l.kq)("",!0)],8,U),[[n.bM,(0,s.SU)(X)]])])]),(0,l._)("div",C,[(0,l.Wm)(u.Z,{isPublic:(0,s.SU)(ae),onUpdate:re},null,8,["isPublic"])])]),(0,l._)("div",D,[(0,l._)("div",P,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>(0,s.dq)(ee)?ee.value=e:null),placeholder:"제목을 입력하세요.",onfocus:"this.placeholder=''",onblur:"this.placeholder='제목을 입력하세요.'"},null,512),[[n.nr,(0,s.SU)(ee)]])])]),(0,l._)("div",L,[(0,l.Wm)((0,s.SU)(d.Z),{ref_key:"CONTENT_EL",ref:Z,modelValue:(0,s.SU)(te),"onUpdate:modelValue":t[4]||(t[4]=e=>(0,s.dq)(te)?te.value=e:null),language:"ko-KR",placeholder:"당신의 이야기를 적어보세요...",toolbars:(0,s.SU)(p.Z),preview:!(0,s.SU)(Y),onKeydown:t[5]||(t[5]=e=>fe(!1))},{defToolbars:(0,l.w5)((()=>[(0,l.Wm)(c.Z,{onInsert:we})])),_:1},8,["modelValue","toolbars","preview"])]),(0,l._)("div",F,[(0,l.Wm)(a,{size:"sm",shape:"line-round",onClick:be,"aria-label":"GPT CREATE START"},{default:(0,l.w5)((()=>[(0,l.Uk)("GPT 초안 생성")])),_:1}),(0,l.Wm)(a,{size:"sm",shape:"line-round",onClick:_e,"aria-label":"GPT CREATE STOP"},{default:(0,l.w5)((()=>[(0,l.Uk)("GPT 초안 정지")])),_:1})]),(0,l._)("div",O,[(0,l._)("div",N,[(0,l._)("label",A,[(0,l.Wm)(i,{svg:"add-image",class:"ico_add-image"}),(0,l.Uk)("사진 추가")]),(0,l._)("input",{ref:"UPLOAD_INPUT_EL",type:"file",id:"upload_input",onChange:ce,onClick:t[6]||(t[6]=t=>e.$refs.UPLOAD_INPUT_EL.value=""),multiple:""},null,544)])]),(0,s.SU)(le).length?((0,l.wg)(),(0,l.iD)("div",H,[(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,s.SU)(le),((e,t)=>((0,l.wg)(),(0,l.iD)("li",{key:t},[(0,l._)("div",j,[(0,l._)("img",{src:`${e.thumbnail}`,class:(0,o.C_)(e.thumbnail===(0,s.SU)(se)?"selected_thumbnail":""),alt:e.serverFileName,onClick:t=>(ve(e),ge(e.thumbnail)),onErrorOnce:t=>pe(t,`post/${e.serverFileName}`)},null,42,x),(0,l.Wm)(a,{class:"image_del_btn",svg:"del-image",theme:"primary",onClick:a=>me(e._id,t),"aria-label":"DELETE IMAGE"},null,8,["onClick"])])])))),128))])])):(0,l.kq)("",!0),(0,l._)("div",G,[(0,l.Wm)(a,{class:"btn_submit",shape:(0,s.SU)(Y)?"fill-round-full":"fill-round",theme:"primary",onClick:t[7]||(t[7]=e=>(fe(!0),de()))},{default:(0,l.w5)((()=>[(0,l.Uk)("작성 완료 ")])),_:1},8,["shape"])])])}}},R=a(3744);const Y=(0,R.Z)(M,[["__scopeId","data-v-92df21be"]]);var K=Y},4835:function(e,t,a){a.d(t,{s:function(){return l}});const l={toolbarTips:{bold:"진하게",underline:"밑줄",italic:"기울임꼴",strikeThrough:"취소선",title:"표제",sub:"아래 첨자",sup:"위 첨자",quote:"인용문",unorderedList:"글머리 기호",orderedList:"번호 매기기",task:"할 일 목록",codeRow:"인라인 코드",code:"코드 블록",link:"링크",image:"이미지",table:"테이블",mermaid:"Mermaid",katex:"Formula",revoke:"되돌리기",next:"다시 실행",save:"임시 저장",prettier:"자동 정렬",pageFullscreen:"페이지 전체화면",fullscreen:"전체화면",preview:"미리보기",htmlPreview:"HTML 미리보기",catalog:"카탈로그",github:" Github 소스 코드"},titleItem:{h1:"1 Heading",h2:"2 Heading",h3:"3 Heading",h4:"4 Heading",h5:"5 Heading",h6:"6 Heading"},imgTitleItem:{link:"링크 추가",upload:"이미지 업로드",clip2upload:"클립 업로드"},linkModalTips:{title:"링크 추가",descLabel:"설명:",descLabelPlaceHolder:"(선택사항) 설명을 입력해 주세요...",urlLabel:"링크:",urlLabelPlaceHolder:"링크를 입력해 주세요...",buttonOK:"완료"},clipModalTips:{title:"클립 이미지 업로드",buttonUpload:"업로드"},copyCode:{text:"복사하기",successTips:"복사 완료!",failTips:"복사 실패..."},mermaid:{flow:"flow",sequence:"sequence",gantt:"gantt",class:"class",state:"state",pie:"pie",relationship:"relationship",journey:"journey"},katex:{inline:"inline",block:"block"},footer:{markdownTotal:"글자 수",scrollAuto:"자동 스크롤"}}},6351:function(e,t,a){a.d(t,{Z:function(){return l}});const l=["bold","underline","italic","-","title","strikeThrough","quote","unorderedList","orderedList","task","-","codeRow","code","link","image","table","mermaid","katex","0","=","revoke","next","save","pageFullscreen","preview","htmlPreview","catalog"]}}]);
//# sourceMappingURL=editor.4991e150.js.map