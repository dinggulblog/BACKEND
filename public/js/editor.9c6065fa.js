(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editor"],{"87f6":function(e,t,n){"use strict";n.r(t);var a=n("7a23");const l=e=>(Object(a["pushScopeId"])("data-v-31ef85ed"),e=e(),Object(a["popScopeId"])(),e),o={class:"editor"},c={class:"wrap_select_toggle"},s={class:"select"},i={class:"main"},d=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"main menu",-1)),r=["value"],u={class:"sub"},b=["disabled"],m=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"sub menu",-1)),p=["value"],g={class:"category"},O=["disabled"],f=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"category",-1)),j=["value"],v={class:"wrap_toggle"},y={class:"wrap_title_file-add-btn"},I={class:"title"},h={class:"images_add_btn"},E=l(()=>Object(a["createElementVNode"])("label",{for:"upload_input",class:"upload_label"},"사진 불러오기",-1)),_={class:"content"},k={key:0,class:"images"},C={class:"wrap_thumbnail"},N=["src","onClick"],S=["onClick"],w=l(()=>Object(a["createElementVNode"])("i",{class:"material-symbols-outlined"}," do_not_disturb_on ",-1)),M=[w],V={class:"wrap_btns"},B={class:"wrap_image_btns"};function P(e,t,n,l,w,P){const D=Object(a["resolveComponent"])("Toggle"),L=Object(a["resolveComponent"])("markdown"),U=Object(a["resolveComponent"])("Button"),x=Object(a["resolveComponent"])("Dialog");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("div",o,[Object(a["createElementVNode"])("div",c,[Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("select",{required:"",onChange:t[0]||(t[0]=(...t)=>e.onChangeMainMenu&&e.onChangeMainMenu(...t))},[d,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(Object.keys(e.menuState.groupMenus),e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:e,value:e},Object(a["toDisplayString"])(e),9,r))),128))],32)]),Object(a["createElementVNode"])("div",u,[Object(a["createElementVNode"])("select",{required:"",disabled:!e.menuState.mainMenus.length,onChange:t[1]||(t[1]=(...t)=>e.onChangeSubMenu&&e.onChangeSubMenu(...t))},[m,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.menuState.mainMenus,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:null===e||void 0===e?void 0:e._id,value:null===e||void 0===e?void 0:e.sub},Object(a["toDisplayString"])(null===e||void 0===e?void 0:e.sub),9,p))),128))],40,b)]),Object(a["createElementVNode"])("div",g,[Object(a["createElementVNode"])("select",{disabled:!e.menuState.subMenu.categories,onChange:t[2]||(t[2]=(...t)=>e.onChangeCategory&&e.onChangeCategory(...t))},[f,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.menuState.subMenu.categories,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:e,value:e},Object(a["toDisplayString"])(e),9,j))),128))],40,O)])]),Object(a["createElementVNode"])("div",v,[Object(a["createVNode"])(D,{isPublic:e.postState.isPublic,onUpdateIsPublic:e.onChangeIsPublic},null,8,["isPublic","onUpdateIsPublic"])])]),Object(a["createElementVNode"])("div",y,[Object(a["createElementVNode"])("div",I,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=t=>e.postState.title=t),placeholder:"제목을 입력하세요.",onfocus:"this.placeholder=''",onblur:"this.placeholder='제목을 입력하세요.'"},null,512),[[a["vModelText"],e.postState.title]])]),Object(a["createElementVNode"])("div",h,[E,Object(a["createElementVNode"])("input",{ref:"UPLOAD_INPUT_EL",type:"file",id:"upload_input",onChange:t[4]||(t[4]=(...t)=>e.onUploadImages&&e.onUploadImages(...t)),onClick:t[5]||(t[5]=t=>e.$refs.UPLOAD_INPUT_EL.value=""),multiple:""},null,544)])]),Object(a["createElementVNode"])("div",_,[Object(a["withDirectives"])(Object(a["createElementVNode"])("textarea",{id:"content-el","onUpdate:modelValue":t[6]||(t[6]=t=>e.postState.content=t),placeholder:"당신의 이야기를 적어보세요...",onKeydown:t[7]||(t[7]=t=>e.onChangeCanLeavePage(!1))},null,544),[[a["vModelText"],e.postState.content]]),Object(a["createVNode"])(L,{class:"markdown",source:e.postState.content,plugins:e.plugins,breaks:!0,xhtmlOut:!0,typographer:!0},null,8,["source","plugins"])]),e.fileState.files.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",k,[Object(a["createElementVNode"])("ul",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.fileState.files,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("li",{key:t.serverFileName},[Object(a["createElementVNode"])("div",C,[Object(a["createElementVNode"])("img",{src:`${e.IMAGE_URL}${t.serverFileName}`,class:Object(a["normalizeClass"])(e.fileState.fileIndex===n?"selected_thumbnail":""),onClick:a=>e.onSelectImage(t,n)},null,10,N),Object(a["createElementVNode"])("button",{class:"image_del_btn",onClick:a=>e.onDeleteImage(t,n)},M,8,S)])]))),128))])])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",V,[Object(a["createElementVNode"])("div",B,[Object(a["withDirectives"])(Object(a["createVNode"])(U,{class:"btn_image_insert",content:"사진 첨부",size:"md",borderColor:"primary-dark",rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:e.onInsertImage},null,8,["full","disabled","onOnClick"]),[[a["vShow"],e.fileState.files.length]]),Object(a["withDirectives"])(Object(a["createVNode"])(U,{class:"btn_image_clear",content:"사진 모두 제거",size:"md",borderColor:"primary-dark",rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:e.onClearImages},null,8,["full","disabled","onOnClick"]),[[a["vShow"],e.fileState.files.length]])]),Object(a["createVNode"])(U,{class:"btn_submit",content:"글 등록",size:"md",bgColor:"primary-dark",custom:!0,rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:t[8]||(t[8]=t=>(e.onChangeCanLeavePage(!0),e.onUpdatePost()))},null,8,["full","disabled"])])]),Object(a["createVNode"])(x,{ref:"Dialog"},null,512)],64)}var D=n("6605"),L=n("5502"),U=n("7702"),x=n("f03e"),F=n.n(x),q=n("362d"),T=n.n(q),A=n("27d0"),z=(n("9f21"),Object(a["defineComponent"])({name:"editor",components:{Toggle:A["a"],Markdown:F.a},setup(){const e=Object(D["d"])(),{go:t,push:n}=Object(D["e"])(),{state:l,commit:o,dispatch:c}=Object(L["b"])();let s=!0;const i=Object(U["a"])("only screen and (max-width: 767px)"),d=Object(a["ref"])(null),r=Object(a["ref"])([{plugin:T.a}]),u=Object(a["ref"])("https://dinggul.me/uploads/"),b=Object(a["reactive"])({isLoading:Object(a["computed"])(()=>l.loading.isLoading),percentage:Object(a["computed"])(()=>l.loading.percentage),groupMenus:Object(a["computed"])(()=>l.menu.groupMenus),mainMenus:[],subMenu:{}}),m=Object(a["reactive"])({postId:"",draftId:"",menu:"",title:"",content:"",category:"기타",isPublic:!0,images:Object(a["computed"])(()=>p.files.map(e=>e._id)),thumbnail:Object(a["computed"])(()=>p.fileId)}),p=Object(a["reactive"])({tempFiles:new FormData,files:[],fileId:"",fileName:"",fileUrl:"http://localhost:3000/uploads/",fileIndex:0}),g=e=>{b.mainMenus=b.groupMenus[e.target.value],document.body.querySelector("div.sub select").selectedIndex=0,document.body.querySelector("div.category select").selectedIndex=0},O=e=>{var t;b.subMenu=b.mainMenus.find(t=>t.sub===e.target.value),m.menu=null===(t=b.subMenu)||void 0===t?void 0:t._id,document.body.querySelector("div.category select").selectedIndex=0},f=e=>{m.category=e.target.value},j=e=>{m.isPublic=Boolean(e)},v=async(e=new FormData)=>{if(!m.menu)return;const{draftId:t,postId:n,...a}=m;Object.keys(a).forEach(t=>e.append(t,a[t]));const{success:l,draft:o,images:s}=t?await c("draft/updateDraft",{draftId:t,payload:e}):await c("draft/createDraft",e);return o&&(m.draftId=o._id),{success:l,images:s}},y=async()=>{if(!m.menu)return alert("게시글을 삽입할 메뉴를 선택해야 합니다.");const{draftId:e,postId:t,...a}=m,{success:l,post:o}=t?await c("post/updatePost",{postId:t,payload:a}):await c("post/createPost",a);l&&s&&n({name:"post",query:{id:o._id}})},I=async e=>{if(!e.target.files.length)return;if(!m.menu)return alert("게시글을 삽입할 메뉴를 선택해야 합니다.");const t=new FormData;Object.values(e.target.files).forEach(e=>t.append("images",e));const{success:n,images:a}=m.postId?await c("post/updatePost",{postId:m.postId,payload:t}):await v(t);n&&a&&(p.files=p.files.concat(a),E(p.files[0],0))},h=async e=>{if(null===e||void 0===e||!e._id)return;const{success:t}=m.postId?await c("post/deleteFile",{postId:m.postId,imageId:e._id}):await c("draft/deleteFile",{draftId:m.draftId,imageId:e._id}),n=p.files.indexOf(e);t&&-1!==n&&(p.files=p.files.filter((e,t)=>t!==n))},E=(e,t)=>{e&&(p.fileId=e._id,p.fileName=e.serverFileName,p.fileUrl=p.fileUrl+p.fileName,p.fileIndex=t)},_=()=>{let e=document.body.querySelector("#content-el"),t=e.value.substring(0,e.selectionStart),n=e.value.substring(e.selectionEnd,e.value.length);const a="![]("+p.fileUrl+")\n";m.content=t+a+n,e.focus()},k=()=>{p.files=[]},C=e=>{s=e},N=e=>{s||(e.preventDefault(),e.returnValue="")},S=(e,t=!1)=>{const{_id:n,menu:a,category:l,title:o,content:c,isPublic:s,images:i,thumbnail:d}=e;t?m.draftId=n:m.postId=n,m.menu=a,m.title=o,m.content=c,m.category=l,m.isPublic=s,p.files=Array.isArray(i)?i:[];const r=p.files.findIndex(e=>e._id===d);d&&-1!==r&&E(p.files[r],r)},w=e.query.id?setInterval(y,6e5):setInterval(v,6e5);return Object(a["onBeforeMount"])(()=>{const{post:n}=l.post,{draft:a}=l.draft;e.query.id&&(n._id?S(n):a._id?S(a,!0):t(-1))}),Object(a["onMounted"])(()=>{window.addEventListener("beforeunload",N);const{menu:e,category:t}=m;if(e){const{main:n,sub:a}=l.menu.menus.find(t=>t._id===e);document.body.querySelector("div.main select").value=n,b.mainMenus=b.groupMenus[n],document.body.querySelector("div.sub select").value=a,b.subMenu=b.mainMenus.find(e=>e.sub===a),t&&(document.body.querySelector("div.category select").value=t)}}),Object(a["onUnmounted"])(async()=>{window.removeEventListener("beforeunload",N),clearInterval(w),o("draft/SET_DRAFT",{})}),Object(D["c"])(async(e,t,n)=>{if(s)n();else{const e=await d.value.show({title:"현재 페이지에서 나가시겠습니까?",message:"임시 저장되지 않은 내용은 사라집니다.",okButton:"나가기",cancelButton:"잠시만요!"});e?n():n(!1)}}),{isMobile:i,Dialog:d,plugins:r,IMAGE_URL:u,menuState:b,postState:m,fileState:p,onChangeCanLeavePage:C,onChangeMainMenu:g,onChangeSubMenu:O,onChangeCategory:f,onChangeIsPublic:j,onUpdatePost:y,onUploadImages:I,onInsertImage:_,onClearImages:k,onDeleteImage:h,onSelectImage:E}}})),R=(n("c7d5"),n("6b0d")),$=n.n(R);const G=$()(z,[["render",P],["__scopeId","data-v-31ef85ed"]]);t["default"]=G},"9f21":function(e,t,n){},c7d5:function(e,t,n){"use strict";n("cd08")},cd08:function(e,t,n){}}]);
//# sourceMappingURL=editor.9c6065fa.js.map