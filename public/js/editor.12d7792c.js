"use strict";(self["webpackChunkDINGGUL"]=self["webpackChunkDINGGUL"]||[]).push([[189],{1462:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});a(7658);var l=a(6252),s=a(2262),o=a(3577),n=a(9963),r=a(2201),u=a(3907),i=a(3257),d=a.n(i),c=a(6635),p=a.n(c),v=a(2127);const _=e=>((0,l.dD)("data-v-474b2e8e"),e=e(),(0,l.Cn)(),e),m={class:"editor"},g={class:"wrap_select_toggle"},f={class:"select"},b={class:"main"},y=_((()=>(0,l._)("option",{selected:"",disabled:"",hidden:"",value:""},"게시판 선택",-1))),w=["value"],h={class:"sub"},S=["disabled"],U=_((()=>(0,l._)("option",{selected:"",disabled:"",hidden:"",value:""},"메뉴 선택",-1))),E=["value"],I={class:"category"},k=["disabled"],T=_((()=>(0,l._)("option",{selected:"",disabled:"",hidden:"",value:""},"카테고리 선택",-1))),C=["value"],D={class:"wrap_toggle"},P={class:"wrap_title_file-add-btn"},q={class:"title"},L={class:"content"},N={class:"wrap_image_btns"},O={class:"images_add_btn"},A={for:"upload_input",class:"upload_label"},F={key:0,class:"images"},M={class:"wrap_thumbnail"},Y=["src","onClick"],G={class:"wrap_btns"};var j={__name:"Editor",setup(e){const t=(0,r.yj)(),{push:a}=(0,r.tv)(),{state:i,dispatch:c,commit:_}=(0,u.oR)(),{postId:j,draftId:B}=t.query,W=[{plugin:p()}],$=(0,l.f3)("isMobile"),x=(0,l.f3)("DIALOG_EL"),H=(0,l.f3)("TOAST_EL"),V=(0,s.iH)(null);let K=null,R=null,z=null,Z=!0;const J=(0,l.Fl)({get:()=>i.post.main??"",set:e=>_("post/SET_MAIN",e)}),Q=(0,l.Fl)({get:()=>i.post.sub??"",set:e=>_("post/SET_SUB",e)}),X=(0,l.Fl)({get:()=>i.post.post.title??"",set:e=>_("post/SET_TITLE",e)}),ee=(0,l.Fl)({get:()=>i.post.post.content??"",set:e=>_("post/SET_CONTENT",e)}),te=(0,l.Fl)({get:()=>i.post.post.category??"",set:e=>_("post/SET_CATEGORY",e)}),ae=(0,l.Fl)({get:()=>i.post.post.isPublic,set:e=>_("post/SET_IS_PUBLIC",e)}),le=(0,l.Fl)({get:()=>i.post.post.images??[],set:e=>_("post/SET_IMAGES",e)}),se=(0,l.Fl)({get:()=>i.post.post.thumbnail,set:e=>_("post/SET_THUMBNAIL",e)}),oe=(0,s.qj)({main:J,sub:Q,title:X,content:ee,category:te,isPublic:ae,images:le.value.map((e=>e._id)),thumbnail:se}),ne=()=>{document.body.querySelector("div.sub select").selectedIndex=0,document.body.querySelector("div.category select").selectedIndex=0},re=()=>{document.body.querySelector("div.category select").selectedIndex=0},ue=e=>{ae.value=Boolean(e)},ie=async e=>{if(!Q.value)return H.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");const{success:t,draft:a,images:l}=await c("draft/updateDraft",{draftId:K,payload:e||oe});return t?(H.value.open("success","임시저장 되었습니다."),K=a._id):H.value.open("error","임시저장에 실패하였습니다"),{success:t,images:l}},de=async()=>{if(!Q.value)return H.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");const{success:e,post:t,error:l}=j?await c("post/updatePost",{payload:oe,postId:j}):await c("post/createPost",{payload:oe});return e?a({name:"post",params:{postId:t._id}}):H.value.open("error",l)},ce=async e=>{if(!e.target.files.length)return;if(!Q.value)return H.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");for(const{name:l}of e.target.files)if(String(l).split(".")[0].length>32)return H.value.open("error","파일명은 32자 이하만 가능합니다.");const t=new FormData;Object.values(e.target.files).forEach((e=>t.append("images",e))),Object.entries(oe).forEach((([e,a])=>t.append(e,a)));const{success:a,images:s,error:o}=j?await c("post/updatePost",{postId:j,payload:t}):await ie(t);if(!a)return H.value.open("error",o);if(Array.isArray(s)&&s.length){le.value=s,ve(s[0]);for await(const e of s)await(0,l.Y3)(),_e(e.thumbnail)}},pe=async(e,t)=>{if("object"!==typeof e)return;const{success:a,error:l}=j?await c("post/deleteFile",{postId:j,imageId:e._id}):await c("draft/deleteFile",{draftId:K,imageId:e._id});if(!a)return H.value.open("error",l);_("post/UNSET_IMAGE",t)},ve=e=>{"object"===typeof e&&(se.value=e._id)},_e=e=>{let t=V.value.value.substring(0,V.value.selectionStart),a=V.value.value.substring(V.value.selectionEnd,V.value.value.length);const l=`\n![](${e})\n`;ee.value=t+l+a,V.value.focus()},me=async()=>{const e=`//localhost:3000/v1/openai/stream/completions?prompt=${X.value}`;return!z||0!==z.readyState&&1!==z.readyState?X.value?.length<6?H.value.open("error","제목을 최소 5글자 이상 입력해주세요."):(z=new EventSource(e,{withCredentials:!0}),z.onmessage=e=>{const t=JSON.parse(e.data);ee.value+=t},void(z.onerror=e=>{"DONE"===e.data?H.value.open("success","초안 작성을 완료하였습니다."):H.value.open("error","서버와 통신이 원할하지 않습니다. 잠시 후 다시 시도해 주세요."),z.close()})):H.value.open("error","초안 생성 중입니다. 생성 종료 버튼을 눌러 진행을 멈추거나 생성이 종료된 후 다시 시도해 주세요.")},ge=()=>{z.close()},fe=e=>{Z=e},be=e=>{Z||(e.preventDefault(),e.returnValue="")};return(0,l.YP)((()=>Z),((e,t)=>{!e||t||R||(R=j?setInterval(de,3e5):setInterval(ie,3e5))})),(0,l.YP)(Q,(()=>{J.value&&_("menu/SET_CURRENT_MENUS",{main:J.value,sub:Q.value})})),(0,l.YP)((()=>t.query),(async()=>{if(j){const{success:e,error:t}=await c("post/getPost",{postId:j});if(!e)return H.value.open("error",t),a({name:"editor"})}else if(B){const{success:e,error:t}=await c("post/getDraft",{draftId:B});if(!e)return H.value.open("error",t),a({name:"editor"});K=B}else _("post/SET_POST",{})}),{immediate:!0}),(0,l.bv)((()=>{window.addEventListener("beforeunload",be),ve(le.value[0])})),(0,l.Ah)((()=>{window.removeEventListener("beforeunload",be),clearInterval(R)})),(0,r.iS)((async(e,t,a)=>{if(Z)a();else{const e=await x.value.show({title:"현재 페이지에서 나가시겠습니까?",message:"임시 저장되지 않은 내용은 사라집니다.",okButton:"나가기",cancelButton:"잠시만요!"});e?a():a(!1)}})),(e,t)=>{const a=(0,l.up)("Button"),r=(0,l.up)("Ico");return(0,l.wg)(),(0,l.iD)("div",m,[(0,l._)("div",g,[(0,l._)("div",f,[(0,l._)("div",b,[(0,l.wy)((0,l._)("select",{required:"","onUpdate:modelValue":t[0]||(t[0]=e=>(0,s.dq)(J)?J.value=e:null),onChange:ne},[y,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(Object.keys(e.$store.state.menu.menus),(e=>((0,l.wg)(),(0,l.iD)("option",{key:e,value:e},(0,o.zw)(e),9,w)))),128))],544),[[n.bM,(0,s.SU)(J)]])]),(0,l._)("div",h,[(0,l.wy)((0,l._)("select",{required:"","onUpdate:modelValue":t[1]||(t[1]=e=>(0,s.dq)(Q)?Q.value=e:null),disabled:!(0,s.SU)(J),onChange:re},[U,(0,s.SU)(J)?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(e.$store.state.menu.menus[(0,s.SU)(J)],(({sub:e})=>((0,l.wg)(),(0,l.iD)("option",{key:e,value:e},(0,o.zw)(e),9,E)))),128)):(0,l.kq)("",!0)],40,S),[[n.bM,(0,s.SU)(Q)]])]),(0,l._)("div",I,[(0,l.wy)((0,l._)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>(0,s.dq)(te)?te.value=e:null),disabled:!(0,s.SU)(Q)},[T,(0,s.SU)(Q)?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(e.$store.state.menu.categories,(e=>((0,l.wg)(),(0,l.iD)("option",{key:e,value:e},(0,o.zw)(e),9,C)))),128)):(0,l.kq)("",!0)],8,k),[[n.bM,(0,s.SU)(te)]])])]),(0,l._)("div",D,[(0,l.Wm)(v.Z,{isPublic:(0,s.SU)(ae),onUpdate:ue},null,8,["isPublic"])])]),(0,l._)("div",P,[(0,l._)("div",q,[(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>(0,s.dq)(X)?X.value=e:null),placeholder:"제목을 입력하세요.",onfocus:"this.placeholder=''",onblur:"this.placeholder='제목을 입력하세요.'"},null,512),[[n.nr,(0,s.SU)(X)]])])]),(0,l._)("div",L,[(0,l.wy)((0,l._)("textarea",{ref_key:"CONTENT_EL",ref:V,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,s.dq)(ee)?ee.value=e:null),placeholder:"당신의 이야기를 적어보세요...",onKeydown:t[5]||(t[5]=e=>fe(!1))},null,544),[[n.nr,(0,s.SU)(ee)]]),(0,l.Wm)((0,s.SU)(d()),{class:"markdown",source:(0,s.SU)(ee),plugins:W,breaks:!0,xhtmlOut:!0,typographer:!0},null,8,["source"])]),(0,l._)("div",null,[(0,l.Wm)(a,{thema:"primary",onClick:me},{default:(0,l.w5)((()=>[(0,l.Uk)("초안 만들기 ")])),_:1}),(0,l.Wm)(a,{thema:"primary",onClick:ge},{default:(0,l.w5)((()=>[(0,l.Uk)("생성 멈춰! ")])),_:1})]),(0,l._)("div",N,[(0,l._)("div",O,[(0,l._)("label",A,[(0,l.Wm)(r,{svg:"add-image",class:"ico_add-image"}),(0,l.Uk)("사진 추가")]),(0,l._)("input",{ref:"UPLOAD_INPUT_EL",type:"file",id:"upload_input",onChange:ce,onClick:t[6]||(t[6]=t=>e.$refs.UPLOAD_INPUT_EL.value=""),multiple:""},null,544)])]),(0,s.SU)(le).length?((0,l.wg)(),(0,l.iD)("div",F,[(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,s.SU)(le),((e,t)=>((0,l.wg)(),(0,l.iD)("li",{key:t},[(0,l._)("div",M,[(0,l._)("img",{src:`${e.thumbnail}`,class:(0,o.C_)(e._id===(0,s.SU)(se)?"selected_thumbnail":""),onClick:t=>(ve(e),_e(e.thumbnail))},null,10,Y),(0,l.Wm)(a,{class:"image_del_btn",svg:"del-image",theme:"primary",onClick:a=>pe(e,t)},null,8,["onClick"])])])))),128))])])):(0,l.kq)("",!0),(0,l._)("div",G,[(0,l.Wm)(a,{class:"btn_submit",shape:(0,s.SU)($)?"fill-round-full":"fill-round",theme:"primary",onClick:t[7]||(t[7]=e=>(fe(!0),de()))},{default:(0,l.w5)((()=>[(0,l.Uk)("작성 완료 ")])),_:1},8,["shape"])])])}}},B=a(3744);const W=(0,B.Z)(j,[["__scopeId","data-v-474b2e8e"]]);var $=W}}]);
//# sourceMappingURL=editor.12d7792c.js.map