(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editor"],{"595d":function(e,t,n){"use strict";n("a990")},"87f6":function(e,t,n){"use strict";n.r(t);var a=n("7a23");const l=e=>(Object(a["pushScopeId"])("data-v-568fbec7"),e=e(),Object(a["popScopeId"])(),e),o={class:"editor"},c={class:"wrap_select_toggle"},s={class:"select"},i={class:"main"},d=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"main menu",-1)),r=["value"],u={class:"sub"},b=["disabled"],m=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"sub menu",-1)),p=["value"],g={class:"category"},O=["disabled"],j=l(()=>Object(a["createElementVNode"])("option",{selected:"",disabled:"",hidden:"",value:""},"category",-1)),v=["value"],f={class:"wrap_toggle"},y={class:"wrap_title_file-add-btn"},h={class:"title"},_={class:"images_add_btn"},k=l(()=>Object(a["createElementVNode"])("label",{for:"upload_input",class:"upload_label"},"사진 불러오기",-1)),E={class:"content"},C={key:0,class:"images"},I={class:"wrap_thumbnail"},N=["src","onClick"],S=["onClick"],w=l(()=>Object(a["createElementVNode"])("i",{class:"material-symbols-outlined"}," do_not_disturb_on ",-1)),V=[w],M={class:"wrap_btns"},B={class:"wrap_image_btns"},L={class:"wrap_right"},P={class:"wrap_isLoading"},U={key:0,class:"isLoading"},D=l(()=>Object(a["createElementVNode"])("i",{class:"material-symbols-outlined"},"hourglass_empty",-1));function x(e,t,n,l,w,x){const q=Object(a["resolveComponent"])("Toggle"),F=Object(a["resolveComponent"])("markdown"),A=Object(a["resolveComponent"])("Button");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",o,[Object(a["createElementVNode"])("div",c,[Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("select",{required:"",onChange:t[0]||(t[0]=(...t)=>e.onChangeMainMenu&&e.onChangeMainMenu(...t))},[d,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(Object.keys(e.menuState.menus),e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:e,value:e},Object(a["toDisplayString"])(e),9,r))),128))],32)]),Object(a["createElementVNode"])("div",u,[Object(a["createElementVNode"])("select",{required:"",disabled:!e.menuState.mainMenus.length,onChange:t[1]||(t[1]=(...t)=>e.onChangeSubMenu&&e.onChangeSubMenu(...t))},[m,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.menuState.mainMenus,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:null===e||void 0===e?void 0:e._id,value:null===e||void 0===e?void 0:e.sub},Object(a["toDisplayString"])(null===e||void 0===e?void 0:e.sub),9,p))),128))],40,b)]),Object(a["createElementVNode"])("div",g,[Object(a["createElementVNode"])("select",{disabled:!e.menuState.subMenu.categories,onChange:t[2]||(t[2]=(...t)=>e.onChangeCategory&&e.onChangeCategory(...t))},[j,(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.menuState.subMenu.categories,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("option",{key:e,value:e},Object(a["toDisplayString"])(e),9,v))),128))],40,O)])]),Object(a["createElementVNode"])("div",f,[Object(a["createVNode"])(q,{isPublic:e.postState.isPublic,onUpdateIsPublic:e.onChangeIsPublic},null,8,["isPublic","onUpdateIsPublic"])])]),Object(a["createElementVNode"])("div",y,[Object(a["createElementVNode"])("div",h,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=t=>e.postState.title=t),placeholder:"제목을 입력하세요.",onfocus:"this.placeholder=''",onblur:"this.placeholder='제목을 입력하세요.'"},null,512),[[a["vModelText"],e.postState.title]])]),Object(a["createElementVNode"])("div",_,[k,Object(a["createElementVNode"])("input",{ref:"UPLOAD_INPUT_EL",type:"file",id:"upload_input",onChange:t[4]||(t[4]=(...t)=>e.onUploadImages&&e.onUploadImages(...t)),onClick:t[5]||(t[5]=t=>e.$refs.UPLOAD_INPUT_EL.value=""),multiple:""},null,544)])]),Object(a["createElementVNode"])("div",E,[Object(a["withDirectives"])(Object(a["createElementVNode"])("textarea",{id:"content-el","onUpdate:modelValue":t[6]||(t[6]=t=>e.postState.content=t),placeholder:"당신의 이야기를 적어보세요...",onKeydown:t[7]||(t[7]=t=>e.onChangeCanLeavePage(!1))},null,544),[[a["vModelText"],e.postState.content]]),Object(a["createVNode"])(F,{class:"markdown",source:e.postState.content,plugins:e.plugins,breaks:!0,xhtmlOut:!0,typographer:!0},null,8,["source","plugins"])]),e.fileState.files.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",C,[Object(a["createElementVNode"])("ul",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.fileState.files,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("li",{key:t.serverFileName},[Object(a["createElementVNode"])("div",I,[Object(a["createElementVNode"])("img",{src:`${e.IMAGE_URL}${t.serverFileName}`,class:Object(a["normalizeClass"])(e.fileState.fileIndex===n?"selected_thumbnail":""),onClick:a=>e.onSelectImage(t,n)},null,10,N),Object(a["createElementVNode"])("button",{class:"image_del_btn",onClick:a=>e.onDeleteImage(t,n)},V,8,S)])]))),128))])])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",M,[Object(a["createElementVNode"])("div",B,[Object(a["withDirectives"])(Object(a["createVNode"])(A,{class:"btn_image_insert",content:"사진 첨부",size:"md",borderColor:"primary-dark",rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:e.onInsertImage},null,8,["full","disabled","onOnClick"]),[[a["vShow"],e.fileState.files.length]]),Object(a["withDirectives"])(Object(a["createVNode"])(A,{class:"btn_image_clear",content:"사진 모두 제거",size:"md",borderColor:"primary-dark",rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:e.onClearImages},null,8,["full","disabled","onOnClick"]),[[a["vShow"],e.fileState.files.length]])]),Object(a["createVNode"])(A,{class:"btn_submit",content:"글 등록",size:"md",bgColor:"primary-dark",custom:!0,rounded:!0,full:!!e.isMobile,disabled:e.menuState.isLoading,onOnClick:t[8]||(t[8]=t=>(e.onChangeCanLeavePage(!0),e.onUpdatePost()))},null,8,["full","disabled"]),Object(a["createElementVNode"])("div",L,[Object(a["createElementVNode"])("div",P,[Object(a["createVNode"])(a["Transition"],{name:"isLoading"},{default:Object(a["withCtx"])(()=>[e.menuState.isLoading?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",U,[D,Object(a["createTextVNode"])(Object(a["toDisplayString"])("자동 저장중..."+e.menuState.percentage),1)])):Object(a["createCommentVNode"])("",!0)]),_:1})])])])])}n("13d5");var q=n("6605"),F=n("5502"),A=n("7702"),T=n("f03e"),z=n.n(T),G=n("362d"),$=n.n(G),J=n("1463"),R=(n("9f21"),Object(a["defineComponent"])({name:"editor",components:{Toggle:J["a"],Markdown:z.a},setup(){const e=Object(q["d"])(),{go:t,push:n}=Object(q["e"])(),{state:l,dispatch:o}=Object(F["b"])(),c=Object(a["inject"])("DIALOG_EL"),s=Object(a["inject"])("TOAST_EL");let i=!0;const d=Object(A["a"])("only screen and (max-width: 767px)"),r=Object(a["ref"])([{plugin:$.a}]),u=Object(a["ref"])("https://dinggul-bucket.s3.ap-northeast-2.amazonaws.com/"),b=(Object(a["ref"])(!1),Object(a["ref"])(null)),m=Object(a["ref"])(null),p=Object(a["reactive"])({isLoading:Object(a["computed"])(()=>l.loading.isLoading),percentage:Object(a["computed"])(()=>l.loading.percentage),menus:Object(a["computed"])(()=>l.menu.menus),mainMenus:[],subMenu:{}}),g=Object(a["reactive"])({menu:"",title:"",content:"",category:"기타",isPublic:!0,images:Object(a["computed"])(()=>O.files.map(({_id:e})=>e)),thumbnail:Object(a["computed"])(()=>O.fileId)}),O=Object(a["reactive"])({files:[],fileId:"",fileName:"",fileUrl:u.value,fileIndex:0}),j=e=>{p.mainMenus=p.menus[e.target.value],document.body.querySelector("div.sub select").selectedIndex=0,document.body.querySelector("div.category select").selectedIndex=0},v=e=>{var t;p.subMenu=p.mainMenus.find(t=>t.sub===e.target.value),g.menu=null===(t=p.subMenu)||void 0===t?void 0:t._id,document.body.querySelector("div.category select").selectedIndex=0},f=e=>{g.category=e.target.value},y=e=>{g.isPublic=Boolean(e)},h=async(e=new FormData)=>{if(!g.menu)return s.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");const{...t}=g;Object.keys(t).forEach(n=>e.append(n,t[n]));const{success:n,draft:a,images:l}=m.value?await o("draft/updateDraft",{draftId:m.value,payload:e}):await o("draft/createDraft",e);return n?s.value.open("success","임시저장 되었습니다."):s.value.open("error","임시저장에 실패하였습니다"),m.value=null===a||void 0===a?void 0:a._id,{success:n,images:l}},_=async()=>{if(!g.menu)return s.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");const{...e}=g,{success:t,post:a}=b.value?await o("post/updatePost",{postId:b,payload:e}):await o("post/createPost",e);t&&i&&n({name:"post",query:{id:a._id}})},k=async e=>{if(!e.target.files.length)return;if(!g.menu)return s.value.open("error","게시글을 삽입할 메뉴를 선택해야 합니다.");const t=new FormData;Object.values(e.target.files).forEach(e=>t.append("images",e));const{success:n,images:a}=b.value?await o("post/updatePost",{postId:b.value,payload:t}):await h(t);n&&Array.isArray(a)&&(O.files.push(...a),C(O.files[0],0))},E=async e=>{if(null===e||void 0===e||!e._id)return;const{success:t}=b.value?await o("post/deleteFile",{postId:b.value,imageId:e._id}):await o("draft/deleteFile",{draftId:m.value,imageId:e._id}),n=O.files.findIndex(({_id:t})=>t===e._id);t&&-1!==n&&(O.files=O.files.filter((e,t)=>t!==n))},C=(e,t)=>{e&&(O.fileId=e._id,O.fileName=e.serverFileName,O.fileUrl=O.fileUrl+O.fileName,O.fileIndex=t)},I=()=>{let e=document.body.querySelector("#content-el"),t=e.value.substring(0,e.selectionStart),n=e.value.substring(e.selectionEnd,e.value.length);const a="![]("+O.fileUrl+")\n";g.content=t+a+n,e.focus()},N=()=>{O.files=[]},S=e=>{i=e},w=e=>{i||(e.preventDefault(),e.returnValue="")},V=(e={},t=!1)=>{const{_id:n,menu:a,category:l,title:o,content:c,isPublic:s,images:i,thumbnail:d}=e;t?m.value=n:b.value=n,g.menu=a,g.title=o,g.content=c,g.category=l,g.isPublic=s,O.files=Array.isArray(i)?i:[];const r=O.files.findIndex(({_id:e})=>e===d);d&&-1!==r&&C(O.files[r],r)},M=e.query.id?setInterval(_,3e5):setInterval(h,3e5);return Object(a["watch"])(()=>g.menu,()=>{const{menu:e,category:t}=g;if(e){const{main:n,sub:a}=Object.keys(p.menus).reduce((t,n)=>{const a=p.menus[n].find(({_id:t})=>t===e);return a&&(t={...a}),t},{});n&&(document.body.querySelector("div.main select").value=n,p.mainMenus=p.menus[n]),a&&(document.body.querySelector("div.sub select").value=a,p.subMenu=p.mainMenus.find(e=>e.sub===a)),t&&(document.body.querySelector("div.category select").value=t)}},{flush:"post"}),Object(a["onBeforeMount"])(async()=>{if(e.query.id){if(l.post.post)return V(l.post.post);const{success:n,post:a,error:c}=await o("post/getPost",{postId:e.query.id});if(!n)return alert(c),t(-1);V(a)}}),Object(a["onMounted"])(()=>{window.addEventListener("beforeunload",w)}),Object(a["onUnmounted"])(async()=>{window.removeEventListener("beforeunload",w),clearInterval(M)}),Object(q["c"])(async(e,t,n)=>{if(i)n();else{const e=await c.value.show({title:"현재 페이지에서 나가시겠습니까?",message:"임시 저장되지 않은 내용은 사라집니다.",okButton:"나가기",cancelButton:"잠시만요!"});e?n():n(!1)}}),{plugins:r,isMobile:d,IMAGE_URL:u,menuState:p,postState:g,fileState:O,onChangeCanLeavePage:S,onChangeMainMenu:j,onChangeSubMenu:v,onChangeCategory:f,onChangeIsPublic:y,onUpdatePost:_,onUploadImages:k,onInsertImage:I,onClearImages:N,onDeleteImage:E,onSelectImage:C}}})),K=(n("595d"),n("6b0d")),H=n.n(K);const Q=H()(R,[["render",x],["__scopeId","data-v-568fbec7"]]);t["default"]=Q},"9f21":function(e,t,n){},a990:function(e,t,n){}}]);
//# sourceMappingURL=editor.4fc40bd9.js.map